"use strict";var pieChart=angular.module("pieChart",[]);pieChart.factory("d3",function(){return d3}),pieChart.directive("pieChart",["d3","globalData","sparqlQuery",function(t,e,a){var r=function(r,n,i,l,c,u){var s=i/1.7,o=s/10,p=t.layout.pie().padAngle(.05).value(function(t){return t.value}),d=Math.min(n,i)/4,f=t.svg.arc().padRadius(s).innerRadius(o),v=(t.svg.arc().outerRadius(.8*d).innerRadius(.4*d),t.svg.arc().innerRadius(.9*d).outerRadius(.9*d),t.svg.arc().innerRadius(1.5*d).outerRadius(1.5*d),t.svg.arc().outerRadius(d+20).innerRadius(d+20)),h=t.scale.ordinal().range(["#B4BFE1","#94A2CF","#7888BF","#5E71AF","#465BA1","#324997","#203A90","#112E8D","#022189"]);r.attr("width",n).attr("height",i);var g=r.append("g");g.append("g").attr("class","slices"),g.append("g").attr("class","labels"),g.append("g").attr("class","lines"),g.attr("transform","translate("+n/2+","+i/2+")");var b=function(t){return t.data.label},m=g.select(".slices").selectAll("path.slice").data(p(c),b);m.enter().append("path").style("fill",function(t){return h(t.data.label)}).attr("class","slice").each(function(t){t.outerRadius=s-40}).attr("d",f).on("mouseover",function(e){t.select("#tooltip p strong").text(e.data.label),t.select("#tooltip").style("left",t.event.pageX+"px").style("top",t.event.pageY+"px").style("opacity",1).select("#value").text(e.value+" "+l+" -   Click to see "+l)}).on("mouseout",function(){t.select("#tooltip").style("opacity",0)}).on("click",function(r){var n=r.data.label;if("Researchers"===l)u.ifClick({value:n});else if("Articles"===l||"Authors"===l){var i=e.PREFIX+' CONSTRUCT {  uc:resultTitle a uc:pagetitle.  uc:resultTitle uc:viewtitle "Authors from '+n+' "  .   ?subject rdfs:label ?name.  ?subject uc:total ?totalPub }    WHERE {   {        SELECT ?subject ?name (COUNT(?pub) AS ?totalPub)   WHERE {  GRAPH <'+e.centralGraph+"> { \t?subject foaf:publications  ?pub .  \t?pub dct:title ?title .  \t?subject foaf:name       ?name.         \t?subject dct:provenance ?provenance.      {          SELECT *          WHERE {          GRAPH <"+e.endpointsGraph+'> {            ?provenance uc:name ?sourcename.            FILTER(mm:fulltext-search(?sourcename,"'+n+'"))             }         }      }  } }  GROUP BY ?subject ?name  HAVING( ?totalPub > 2 && ?totalPub < 500) } } limit 150';waitingDialog.show("Loading All Authors of Selected Source"),a.querySrv({query:i},function(t){jsonld.compact(t,e.CONTEXT,function(t,e){if(e){e["@graph"];u.ifClick({value:e}),waitingDialog.hide()}else waitingDialog.hide()})})}return t.event.preventDefault()}),m.enter().append("text").attr("transform",function(t){return"translate("+v.centroid(t)+")"}).attr("class","piechart-text").attr("dy",".35em").text(function(t){return t.data.value})};return{restrict:"E",scope:{data:"=",ifClick:"&"},compile:function(e,a,n){var i=t.select(e[0]).append("svg"),l=parseInt(e.css("width")),c=a.pcWidth?a.pcWidth:l,u=a.pcHeight;return function(t,e,a){t.$watch("data",function(t,e,a){var n=a.data;if(n){var l=n.entityName;n=n.data,r(i,c,u,l,n,a)}},!0)}}}}]);