wkhomeControllers.controller("map",["$routeParams","$scope","$window","globalData","sparqlQuery","searchData",function(e,a,c,t,o,n){if(a.ifClick=function(a){n.genericData=a,c.location.hash="/"+e.lang+"/w/cloud?datacloud"},a.themes=[],n.allkeywords)a.relatedtags=n.allkeywords,a.selectedTagItem="Semantic Web";else{waitingDialog.show("Loading Research Areas");var l=t.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key }  WHERE {      SELECT  (count(?pubs) as ?total)      WHERE {          graph <"+t.centralGraph+'> {             ?subject foaf:publications ?pubs.              ?pubs dcterms:subject ?keywordSubject.              ?keywordSubject rdfs:label ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }     }      GROUP BY ?keyword  ?key      HAVING(?total > 4) }';o.querySrv({query:l},function(e){jsonld.compact(e,t.CONTEXT,function(e,c){_.map(c["@graph"],function(e){var c={};c.id=e["@id"],c.tag=e["rdfs:label"],a.themes.push({tag:c.tag})}),a.$apply(function(){a.relatedtags=a.themes,a.selectedTagItem="Semantic Web",n.allkeywords=a.themes}),waitingDialog.hide()})})}a.$watch("selectedTagItem",function(){a.selectedTagItem=a.selectedTagItem?a.selectedTagItem:"Semantic Web",waitingDialog.show('Consultando Ubicacion de Autores Relacionados con:  "'+a.selectedTagItem+'"');var e=t.PREFIX+' CONSTRUCT {          ?urikeyword dcterms:subject "'+a.selectedTagItem+'".          ?urikeyword uc:totalpublications ?cont.          ?urikeyword uc:name ?sourcename.           ?urikeyword uc:lat ?lat.          ?urikeyword uc:long ?long.          ?urikeyword uc:province ?province.          ?urikeyword uc:city ?city.          ?urikeyword uc:fullname ?fullname.  } WHERE {     SELECT (COUNT( DISTINCT ?object) as ?cont) ?provenance  ?urikeyword ?provenance ?sourcename ?lat ?long ?province ?city ?fullname      WHERE {         GRAPH <'+t.centralGraph+'>  {             ?subject foaf:publications ?object.             ?object dcterms:subject ?keywordSubject.              ?keywordSubject rdfs:label ?key.             FILTER (mm:fulltext-search(?key, "'+a.selectedTagItem+'")) .             ?subject dct:provenance ?provenance.             {                  SELECT DISTINCT ?sourcename ?lat ?long ?province ?city (STR(?name) as ?fullname)                  WHERE {                      GRAPH <'+t.endpointsGraph+'>  {                          ?provenance uc:name ?sourcename.                          ?provenance  uc:latitude ?lat.                          ?provenance uc:longitude ?long.                          ?provenance uc:province ?province.                          ?provenance uc:city ?city.                          ?provenance uc:fullName ?name.                         FILTER (lang(?name) = "es").                     }                  }              }              BIND(REPLACE("'+a.selectedTagItem+'"," ","_","i") + "_" + ?sourcename  as ?iduri).              BIND(IRI(?iduri) as ?urikeyword)          }      }      GROUP BY ?sourcename ?provenance ?lat ?long ?province ?city ?fullname  ?urikeyword  } ';a.publicationsBySource=[],o.querySrv({query:e},function(e){jsonld.compact(e,t.CONTEXT,function(e,c){if(c["@graph"]){waitingDialog.hide();_.map(c["@graph"],function(e){var c={};c.id=e["@id"],c.name=e["uc:name"],c.fullname=e["uc:fullname"],c.total=e["uc:totalpublications"]["@value"],c.lat=e["uc:lat"],c["long"]=e["uc:long"],c.keyword=e["dct:subject"],c.city=e["uc:city"],c.province=e["uc:province"],c.id&&a.publicationsBySource.push({id:c.id,name:c.name,fullname:c.fullname,total:c.total,latitude:c.lat,longitude:c["long"],city:c.city,province:c.province,keyword:c.keyword})}),a.$apply(function(){a.data=a.publicationsBySource})}else alert("Informacion no encontrada"),waitingDialog.hide()})})})}]);