wkhomeControllers.controller("searchText",["$routeParams","$scope","$window","globalData","sparqlQuery","searchData","searchQueryService","$location","AuthorsService","KeywordsService","PublicationsService","searchTextResultsService",function(a,e,t,n,r,o,s,l,c,u,h,g){function b(a,e,i,t){this.id=a,this.val=e,this.desc=i,this.path=t}String.format=function(){for(var a=arguments[0],e=1;e<arguments.length;e++){var i=new RegExp("\\{"+(e-1)+"\\}","gm");a=a.replace(i,arguments[e])}return a};var f=n.PREFIX+"CONSTRUCT {  ?keyword uc:publication ?publicationUri.  ?publicationUri dct:contributors ?subject .   ?subject foaf:name ?name .  ?subject a foaf:Person .   ?publicationUri a bibo:Document.   ?publicationUri dct:title ?title.  ?publicationUri bibo:abstract ?abstract.   ?publicationUri bibo:uri ?uri. } WHERE {   GRAPH <"+n.centralGraph+"> {  {0}     ?subject foaf:publications ?publicationUri .     ?subject foaf:name ?name .     ?publicationUri dct:title ?title .     OPTIONAL{ ?publicationUri bibo:abstract ?abstract. }     OPTIONAL{ ?publicationUri bibo:uri ?uri. }  }}";e.submit=function(){e.searchText&&(waitingDialog.show(),c.get({search:e.searchText},function(s){if(s.response.docs.length>0){var c=s.response.docs;if(c.length>1){var p="/w/author/",d=_.map(c,function(a){var e=a["lmf.uri"],i=_.max(a.name,function(a){return a.length}),t=_.chain(a.topics).uniq().first(10).value().join(", "),n=new b(e,i,t,p);return n});e.candidates=d,g.saveData(d),waitingDialog.hide(),$("#searchResults").modal("show")}else if(1===c.length){var m=c[0]["lmf.uri"];waitingDialog.hide(),t.location.hash="/"+a.lang+"/w/author/"+m}}else u.get({search:e.searchText},function(s){var c=_.uniq(s.response.docs,function(a){return a["lmf.uri"]});if(c.length>1){var u=_.map(c,function(a){var e=_.first(a.keyword),i=new b(e,e,(void 0),"/cloud/group-by?area=");return i});e.candidates=u,g.saveData(u),waitingDialog.hide(),$("#searchResults").modal("show")}else if(1===c.length){var p=_(c[0].keyword).first();waitingDialog.hide(),l.path(a.lang+"/cloud/group-by/").search({area:p}),t.location.hash="/"+a.lang+"/cloud/group-by?area="+p}else h.get({search:e.searchText},function(e){if(e.response.docs.length>0){var s=e.response.docs,l=" <{0}> ",c="values ?publicationUri {";for(i=0;i<s.length;i++)c+=String.format(l,s[i]["lmf.uri"]);c+="}";var u=String.format(f,c);r.querySrv({query:u},function(e){jsonld.compact(e,n.CONTEXT,function(e,i){i["@graph"]?(waitingDialog.hide(),o.publicationsSearch=i,t.location.hash="/"+a.lang+"/w/listAllText"):("es"===a.lang?alert("La información no se encuentra disponible en REDI en este momento."):alert("The information is not available in REDI at the moment. Please try again later."),waitingDialog.hide())})})}else"es"===a.lang?alert("La información no se encuentra disponible en REDI en este momento."):alert("The information is not available in REDI at the moment. Please try again later."),waitingDialog.hide()})})}),e.searchText="")}}]);