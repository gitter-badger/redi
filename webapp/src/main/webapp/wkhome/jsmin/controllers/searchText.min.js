wkhomeControllers.controller("searchText",["$routeParams","$scope","$window","globalData","sparqlQuery","searchData","searchQueryService","AuthorsService","KeywordsService","PublicationsService",function(e,a,t,n,o,r,l,s,c,u){String.format=function(){for(var e=arguments[0],i=1;i<arguments.length;i++){var a=new RegExp("\\{"+(i-1)+"\\}","gm");e=e.replace(a,arguments[i])}return e};var h=n.PREFIX+"CONSTRUCT {  ?keyword uc:publication ?publicationUri.  ?publicationUri dct:contributors ?subject .   ?subject foaf:name ?name .  ?subject a foaf:Person .   ?publicationUri a bibo:Document.   ?publicationUri dct:title ?title.  ?publicationUri bibo:abstract ?abstract.   ?publicationUri bibo:uri ?uri. } WHERE {   GRAPH <"+n.centralGraph+"> {  {0}     ?subject foaf:publications ?publicationUri .     ?subject foaf:name ?name .     ?publicationUri dct:title ?title .     OPTIONAL{ ?publicationUri bibo:abstract ?abstract. }     OPTIONAL{ ?publicationUri bibo:uri ?uri. }  }}";a.submit=function(){a.searchText&&(waitingDialog.show(),s.get({search:a.searchText},function(l){if(l.response.docs.length>0){var s=l.response.docs;if(s.length>1){var b=_.map(s,function(e){var i={};return i.id=e["lmf.uri"],i.name=_.max(e.name,function(e){return e.length}),i.keyword=_.chain(e.topics).uniq().first(10).value().join(", "),i});a.candidates=b,a.selectedAuthor=function(i,a){$("#searchResults").modal("hide"),$("#searchResults").on("hidden.bs.modal",function(){t.location.hash="/"+e.lang+"/w/author/"+a})},waitingDialog.hide(),$("#searchResults").modal("show")}else if(1===s.length){var f=s[0]["lmf.uri"];waitingDialog.hide(),t.location.hash="/"+e.lang+"/w/author/"+f}}else c.get({search:a.searchText},function(l){if(l.response.docs.length>0){var s=l.response.docs,c=_.map(s,function(e){var i={};return i.id=e["lmf.uri"],i.label=_.first(e.keyword),i});waitingDialog.hide(),r.areaSearch=c,t.location.hash="/"+e.lang+"/cloud/group-by"}else u.get({search:a.searchText},function(a){if(a.response.docs.length>0){var l=a.response.docs,s=" <{0}> ",c="values ?publicationUri {";for(i=0;i<l.length;i++)c+=String.format(s,l[i]["lmf.uri"]);c+="}";var u=String.format(h,c);o.querySrv({query:u},function(i){jsonld.compact(i,n.CONTEXT,function(i,a){a["@graph"]?(waitingDialog.hide(),r.publicationsSearch=a,t.location.hash="/"+e.lang+"/w/listAllText"):("es"===e.lang?alert("La información no se encuentra disponible en REDI en este momento."):alert("The information is not available in REDI at the moment. Please try again later."),waitingDialog.hide())})})}else"es"===e.lang?alert("La información no se encuentra disponible en REDI en este momento."):alert("The information is not available in REDI at the moment. Please try again later."),waitingDialog.hide()})})}))}}]);