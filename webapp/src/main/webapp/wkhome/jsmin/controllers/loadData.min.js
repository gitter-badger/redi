wkhomeControllers.controller("loadData",["sparqlQuery","searchData","$translate","$routeParams","$scope","$window","translateService","globalData",function(e,t,r,a,u,l,s,o){function c(){var r=o.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key } \tFROM <"+o.centralGraph+'>  WHERE {      SELECT  (count(?key) as ?k) ?key          WHERE {              ?subject foaf:publications ?pub.              ?pub dcterms:subject ?keySub.              ?keySub rdfs:label ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }      GROUP BY ?keyword  ?key      HAVING(?k > 4) }';e.querySrv({query:r},function(e){jsonld.compact(e,o.CONTEXT,function(e,r){_.map(r["@graph"],function(e){var t={};t.id=e["@id"],t.tag=e["rdfs:label"],u.themes.push({tag:t.tag})}),u.$apply(function(){t.allkeywordsList=u.themes,u.relatedthemes=t.allkeywordsList,u.selectedItem=""})})})}function n(){if(null==t.clustersAuthors||0==t.clustersAuthors.length){u.clusters=[];var r=[],a=(new Array,o.PREFIX+"CONSTRUCT {  ?author foaf:name ?name;          uc:hasCluster ?clusterId;          rdfs:label ?label;          dct:subject ?keywords.} WHERE {  GRAPH <"+o.clustersGraph+"> {    ?clusterId foaf:publications ?publication;               rdfs:label ?label.    ?publication uc:hasPerson ?author.    GRAPH <"+o.centralGraph+">  {      ?author foaf:name ?name.      ?publication dct:subject [rdfs:label ?keywords].    }   }}");e.querySrv({query:a},function(e){jsonld.compact(e,o.CONTEXT,function(e,a){_.map(a["@graph"],function(e){var t={},a=e["uc:hasCluster"],u="";if(null!=e["dcterms:subject"]&&(e["dcterms:subject"].constructor===Array||e["dcterms:subject"]instanceof Array))for(i=0;i<e["dcterms:subject"].length&&i<12;i++)u+=0==i?e["dcterms:subject"][i]:", "+e["dcterms:subject"][i];if(null!=a&&(a.constructor===Array||a instanceof Array))for(i=0;i<a.length;i++)t.IdAuthor=e["@id"],t.IdCluster=e["uc:hasCluster"][i]["@id"],t.ClusterName=e["rdfs:label"][i],t.Author=e["foaf:name"],t.Keyword=u,t.Title=e["foaf:name"],t.URI=e["foaf:name"],r.push({idAuthor:t.IdAuthor,cluster:t.IdCluster,clusterName:t.ClusterName,author:t.Author,keyword:t.Keyword,title:t.Title,uri:t.URI});else t.IdAuthor=e["@id"],t.IdCluster=e["uc:hasCluster"]["@id"],t.ClusterName=e["rdfs:label"],t.Author=e["foaf:name"],t.Keyword=u,t.Title=e["foaf:name"],t.URI=e["foaf:name"],r.push({idAuthor:t.IdAuthor,cluster:t.IdCluster,clusterName:t.ClusterName,author:t.Author,keyword:t.Keyword,title:t.Title,uri:t.URI})});var l=new Array;for(i=0,len=r.length;i<len;i++)null==l[r[i].cluster.toString()]&&(l[r[i].cluster.toString()]=new Array,l[r[i].cluster.toString()][0]=1,l[r[i].cluster.toString()][1]=0),l[r[i].cluster.toString()][0]=l[r[i].cluster.toString()][0]+1;for(i=0,len=r.length;i<len;i++)l[r[i].cluster.toString()][0]>4&&l[r[i].cluster.toString()][1]<95&&(u.clusters.push(r[i]),l[r[i].cluster.toString()][1]+=1);t.clustersAuthors=u.clusters,t.areaSearch=null})})}}c(),u.themes=[];var d=o.PREFIX+" CONSTRUCT {          ?keyword rdfs:label ?k;                uc:total ?totalPub }  FROM <"+o.centralGraph+">   WHERE {      SELECT ?keyword ?k (COUNT(DISTINCT(?subject)) AS ?totalPub)      WHERE {          ?person foaf:publications ?subject.          ?subject dcterms:subject ?keywordSubject.          ?keywordSubject rdfs:label ?k.          BIND(IRI(?k) AS ?keyword) .      }      GROUP BY ?keyword ?k      HAVING(?totalPub > 2 && ?totalPub < 180)      ORDER BY DESC(?totalPub)      LIMIT 145 } ";e.querySrv({query:d},function(e){jsonld.compact(e,o.CONTEXT,function(e,r){u.$apply(function(){t.allkeywordsCloud={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:r},waitingDialog.hide()})})}),t.dataRequested||(n(),t.dataRequested=!0),u.clusters=[]}]);