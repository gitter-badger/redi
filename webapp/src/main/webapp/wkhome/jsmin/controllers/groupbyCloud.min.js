wkhomeControllers.controller("groupbyCloud",["$translate","$routeParams","$scope","globalData","sparqlQuery","$route","$window","$location","Statistics",function(a,e,t,o,r,n,i,c,s){function u(a,e){waitingDialog.show('Consultando Autores Relacionados con:  "'+a+'"');var t=o.PREFIX+'CONSTRUCT {  ?author foaf:name  ?nameauthor;          dct:provenance ?sourcename .}  WHERE {  ?author foaf:publications ?publication ;          foaf:name  ?nameauthor;          dct:provenance ?provenance.  ?publication dct:subject [rdfs:label ?keyword].  FILTER (mm:fulltext-search(?keyword, "'+a+'"))  GRAPH <'+o.endpointsGraph+"> {    ?provenance uc:name ?sourcename.  }} LIMIT 200";r.querySrv({query:t},function(a){jsonld.compact(a,o.CONTEXT,function(a,t){if(t["@graph"]){var o=_.chain(t["@graph"]).map(function(a){var e=_.isArray(a["foaf:name"])?_(a["foaf:name"]).first():a["foaf:name"];if(a["dct:provenance"]instanceof Array){var t=[];return _(a["dct:provenance"]).each(function(o){t.push({id:a["@id"],name:e,organization:o})}),t}return{id:a["@id"],name:e,organization:a["dct:provenance"]}}).flatten().uniq(function(a){return a.id+a.organization}).value();l(o,e),waitingDialog.hide(),$("html,body").animate({scrollTop:$("#scrollToTop").offset().top},"slow")}else alert("No se han recuperado datos"),waitingDialog.hide()})})}function l(a,e){t.$apply(function(){t.data=[{value:a,group:e}]})}a.use(e.lang),t.selectedArea=e.area,s.query({id:"keywords_frequencypub_gt4"},function(a){t.areas=[],_.map(a["@graph"],function(a){t.areas.push({tag:a["rdfs:label"]})})}),t.ifClick=function(a){t.todos=[];var e={};_.map(a,function(a){e.id=a["@id"],e.title="string"==typeof a["dct:title"]?a["dct:title"]:_(a["dct:title"]).first(),e["abstract"]="string"==typeof a["bibo:abstract"]?a["bibo:abstract"]:_(a["bibo:abstract"]).first(),e.uri=_.isArray(a["bibo:uri"])?_(a["bibo:uri"]).first():a["bibo:uri"]["@id"]?a["bibo:uri"]:"",e.keywords=a["dct:subject"]?a["dct:subject"]:"",t.todos.push({id:e.id,title:e.title,"abstract":e["abstract"],uri:e.uri,keywords:e.keywords})}),t.loadData(),$("html,body").animate({scrollTop:$("#scrollToHere").offset().top},"slow")},t.querySearch=function(a){var e=t.areas,o=angular.lowercase(a);return a&&(e=t.areas.filter(function(a){return angular.lowercase(a.tag).indexOf(o)!==-1})),_(e).pluck("tag")},t.$watch("selectedArea",function(){if(t.selectedArea){c.search({area:t.selectedArea}),t.todos=[],t.filteredTodos=[],u(t.selectedArea,"organization");var a=$("div.tree-node-author-info .authorsByClusters");a.html(""),a=$("div.tree-node-author-info .authorsByPublications"),a.html("");var e=$("div#scrollToHere.col-md-12 div.col-md-12.head-info");e.html("")}}),t.todos=[],t.loadData=function(){t.filteredTodos=[],t.currentPage=1,t.numPerPage=10,t.maxSize=5,t.$watch("currentPage + numPerPage",function(){var a=(t.currentPage-1)*t.numPerPage,e=a+t.numPerPage;t.filteredTodos=t.todos.slice(a,e)})},t.exportReport=function(a){t.author=a,t.showRepButtons=!0}}]);