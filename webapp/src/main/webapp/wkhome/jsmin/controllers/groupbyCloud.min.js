wkhomeControllers.controller("groupbyCloud",["$translate","$routeParams","$scope","globalData","sparqlQuery","searchData","$route","$window",function(e,a,t,o,r,n,c,s){function u(){var e=o.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key }  WHERE {      SELECT  (count(?pubs) as ?total)      WHERE {          graph <"+o.centralGraph+'> {             ?subject foaf:publications ?pubs.              ?pubs dcterms:subject ?keywordSubject.              ?keywordSubject rdfs:label ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }     }      GROUP BY ?keyword  ?key      HAVING(?total > 4) }';r.querySrv({query:e},function(e){jsonld.compact(e,o.CONTEXT,function(e,a){_.map(a["@graph"],function(e){var a={};a.id=e["@id"],a.tag=e["rdfs:label"],t.themes.push({tag:a.tag})}),i(),waitingDialog.hide()})})}function i(){t.$apply(function(){t.relatedthemes=t.themes,t.selectedItem=n.researchArea,n.allkeywords=t.themes})}function l(e,a){}function d(e,a){var c=o.PREFIX+' CONSTRUCT {       ?subject foaf:name  ?nameauthor .  ?subject  dct:provenance ?sourcename . }  WHERE {    ?subject foaf:publications ?pubs .    ?subject foaf:name  ?nameauthor .    ?pubs dcterms:subject ?keywordSubject.    ?keywordSubject rdfs:label ?keyword.    ?subject dct:provenance ?provenance      FILTER (mm:fulltext-search(?keyword, "'+e+'"))     {          select *             WHERE             {                 graph <'+o.endpointsGraph+">                 {                      ?provenance uc:name ?sourcename                 }             }     }                                                            } LIMIT 200 ";t.authorsByKeyword=[],r.querySrv({query:c},function(e){jsonld.compact(e,o.CONTEXT,function(e,o){o["@graph"]?(_.map(o["@graph"],function(e){var a={};a.Author=e["@id"],a.Name=e["foaf:name"],a.Organization=e["dct:provenance"],t.$apply(function(){t.authorsByKeyword.push({id:a.Author,name:a.Name,organization:a.Organization})})}),f(t.authorsByKeyword,a),n.areaSearch=null,waitingDialog.hide()):(alert("No se han recuperado datos"),waitingDialog.hide())})})}function f(e,a){t.$apply(function(){t.data=[{value:e,group:a}],t.dataaux=e})}e.use(a.lang);var h=null;if(t.ifClick=function(e){t.todos=[];var a={};_.map(e,function(e){a.id=e["@id"],a.title=e["dct:title"],a["abstract"]=e["bibo:abstract"]?e["bibo:abstract"]:"",a.uri=e["bibo:uri"]?e["bibo:uri"]["@id"]:"",a.keywords=e["dcterms:subject"]?e["dcterms:subject"]:"",t.todos.push({id:a.id,title:a.title,"abstract":a["abstract"],uri:a.uri,keywords:a.keywords})}),t.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:e},t.loadData(),t.todos[0]&&t.searchAuthor(t.todos[0]),$("html,body").animate({scrollTop:$("#scrollToHere").offset().top},"slow")},$("html,body").animate({scrollTop:$("#scrollToTop").offset().top},"slow"),n.areaSearch){var m=n.areaSearch;m.length>0?(t.candidates=m,t.selectedAuthor=function(e,a){$("#searchResults").modal("hide"),n.researchArea=a,t.selectedItem=a},waitingDialog.hide()):(alert("Information not found"),s.location.hash="/",waitingDialog.hide())}n.allkeywords?(t.relatedthemes=n.allkeywords,t.selectedItem=n.researchArea):(t.themes=[],u()),t.$watch("gbselectedItem",function(){l(t.dataaux,t.gbselectedItem)}),t.$watch("selectedItem",function(){t.selectedItem=t.selectedItem?t.selectedItem:"Semantic Web",t.todos=[],t.filteredTodos=[],d(t.selectedItem,t.gbselectedItem);var e=$("div.tree-node-author-info .authorsByClusters");e.html(""),e=$("div.tree-node-author-info .authorsByPublications"),e.html("");var a=$("div#scrollToHere.col-md-12 div.col-md-12.head-info");a.html("")}),t.todos=[],t.loadData=function(){t.filteredTodos=[],t.currentPage=1,t.numPerPage=10,t.maxSize=5,t.$watch("currentPage + numPerPage",function(){var e=(t.currentPage-1)*t.numPerPage,a=e+t.numPerPage;t.filteredTodos=t.todos.slice(e,a)})},t.$watch(h,function(e,a,r){e&&(t.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:n.genericData},t.loadData(),t.todos[0]&&t.searchAuthor(t.todos[0]))}),t.searchAuthor=function(e){var a=o.PREFIX+" CONSTRUCT {   ?subject foaf:name ?name; a foaf:Person   }   WHERE {     Graph <"+o.centralGraph+">     {         ?subject a foaf:Person.         ?subject foaf:name ?name.         ?subject foaf:publications <"+e.id+">.     }} limit 1";r.querySrv({query:a},function(e){jsonld.compact(e,o.CONTEXT,function(e,a){t.$apply(function(){t.loadRelatedAuthors(a)})})})},t.loadRelatedAuthors=function(e){clickonRelatedauthor=function(e){var c=o.PREFIX+" CONSTRUCT {   <"+e+"> foaf:name ?name; a foaf:Person   }    WHERE  {     <"+e+"> foaf:name ?name } ";r.querySrv({query:c},function(r){jsonld.compact(r,o.CONTEXT,function(o,r){t.$apply(function(){n.authorSearch=r,s.location.hash="/"+a.lang+"/w/search?"+e})})})}},t.exportReport=function(e){t.author=e,t.showRepButtons=!0}}]);