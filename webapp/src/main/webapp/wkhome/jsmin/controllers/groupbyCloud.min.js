wkhomeControllers.controller("groupbyCloud",["$translate","$routeParams","$scope","globalData","sparqlQuery","searchData","$route","$window",function(e,t,a,o,r,n,c,s){function i(){var e=o.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key }  WHERE {      SELECT  (count(?pubs) as ?total)      WHERE {          graph <"+o.centralGraph+'> {             ?subject foaf:publications ?pubs.              ?pubs dcterms:subject ?keywordSubject.              ?keywordSubject rdfs:label ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }     }      GROUP BY ?keyword  ?key      HAVING(?total > 4) }';r.querySrv({query:e},function(e){jsonld.compact(e,o.CONTEXT,function(e,t){_.map(t["@graph"],function(e){var t={};t.id=e["@id"],t.tag=e["rdfs:label"],a.themes.push({tag:t.tag})}),u(),waitingDialog.hide()})})}function u(){a.$apply(function(){a.relatedthemes=a.themes,a.selectedItem=n.researchArea,n.allkeywords=a.themes})}function l(e,t){}function d(e,t){var c=o.PREFIX+' CONSTRUCT {       ?subject foaf:name  ?nameauthor .  ?subject  dct:provenance ?sourcename . }  WHERE {    ?subject foaf:publications ?pubs .    ?subject foaf:name  ?nameauthor .    ?pubs dcterms:subject ?keywordSubject.    ?keywordSubject rdfs:label ?keyword.    ?subject dct:provenance ?provenance      FILTER (mm:fulltext-search(?keyword, "'+e+'"))     {          select *             WHERE             {                 graph <'+o.endpointsGraph+">                 {                      ?provenance uc:name ?sourcename                 }             }     }                                                            } LIMIT 200 ";a.authorsByKeyword=[],r.querySrv({query:c},function(e){jsonld.compact(e,o.CONTEXT,function(e,o){o["@graph"]?(_.map(o["@graph"],function(e){var t={};t.Author=e["@id"],t.Name=e["foaf:name"],t.Organization=e["dct:provenance"],a.$apply(function(){a.authorsByKeyword.push({id:t.Author,name:t.Name,organization:t.Organization})})}),f(a.authorsByKeyword,t),n.areaSearch=null,waitingDialog.hide()):(alert("No se han recuperado datos"),waitingDialog.hide())})})}function f(e,t){a.$apply(function(){a.data=[{value:e,group:t}],a.dataaux=e})}e.use(t.lang);var h=null;if(a.ifClick=function(e){a.todos=[];var t={};_.map(e,function(e){t.id=e["@id"],t.title="string"==typeof e["dct:title"]?e["dct:title"]:_(e["dct:title"]).first(),t["abstract"]="string"==typeof e["bibo:abstract"]?e["bibo:abstract"]:_(e["bibo:abstract"]).first(),t.uri="string"==typeof e["bibo:uri"]?e["bibo:uri"]:_.some(e["bibo:uri"],function(e){return _(e).has("@id")})?_.first(e["bibo:uri"]):"",t.keywords=e["dct:subject"]?e["dct:subject"]:"",a.todos.push({id:t.id,title:t.title,"abstract":t["abstract"],uri:t.uri,keywords:t.keywords})}),a.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:e},a.loadData(),a.todos[0]&&a.searchAuthor(a.todos[0]),$("html,body").animate({scrollTop:$("#scrollToHere").offset().top},"slow")},$("html,body").animate({scrollTop:$("#scrollToTop").offset().top},"slow"),n.areaSearch){var m=n.areaSearch;m.length>0?(a.candidates=m,a.selectedAuthor=function(e,t){$("#searchResults").modal("hide"),n.researchArea=t,a.selectedItem=t},waitingDialog.hide()):(alert("Information not found"),s.location.hash="/",waitingDialog.hide())}n.allkeywords?(a.relatedthemes=n.allkeywords,a.selectedItem=n.researchArea):(a.themes=[],i()),a.$watch("gbselectedItem",function(){l(a.dataaux,a.gbselectedItem)}),a.$watch("selectedItem",function(){a.selectedItem=a.selectedItem?a.selectedItem:"Semantic Web",a.todos=[],a.filteredTodos=[],d(a.selectedItem,a.gbselectedItem);var e=$("div.tree-node-author-info .authorsByClusters");e.html(""),e=$("div.tree-node-author-info .authorsByPublications"),e.html("");var t=$("div#scrollToHere.col-md-12 div.col-md-12.head-info");t.html("")}),a.todos=[],a.loadData=function(){a.filteredTodos=[],a.currentPage=1,a.numPerPage=10,a.maxSize=5,a.$watch("currentPage + numPerPage",function(){var e=(a.currentPage-1)*a.numPerPage,t=e+a.numPerPage;a.filteredTodos=a.todos.slice(e,t)})},a.$watch(h,function(e,t,r){e&&(a.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:n.genericData},a.loadData(),a.todos[0]&&a.searchAuthor(a.todos[0]))}),a.searchAuthor=function(e){var t=o.PREFIX+" CONSTRUCT {   ?subject foaf:name ?name; a foaf:Person   }   WHERE {     Graph <"+o.centralGraph+">     {         ?subject a foaf:Person.         ?subject foaf:name ?name.         ?subject foaf:publications <"+e.id+">.     }} limit 1";r.querySrv({query:t},function(e){jsonld.compact(e,o.CONTEXT,function(e,t){a.$apply(function(){a.loadRelatedAuthors(t)})})})},a.loadRelatedAuthors=function(e){clickonRelatedauthor=function(e){var c=o.PREFIX+" CONSTRUCT {   <"+e+"> foaf:name ?name; a foaf:Person   }    WHERE  {     <"+e+"> foaf:name ?name } ";r.querySrv({query:c},function(r){jsonld.compact(r,o.CONTEXT,function(o,r){a.$apply(function(){n.authorSearch=r,s.location.hash="/"+t.lang+"/w/search?"+e})})})}},a.exportReport=function(e){a.author=e,a.showRepButtons=!0}}]);